<div>
    <p class="font-semibold">Building & Plot Mapping</p>
    <div class="mt-1">
        <label for="zhichar">Enter Plot ID</label>
        <div class="flex mt-2 mb-2 gap-4 align-items-center">
            <input
                pInputText
                id="zhichar"
                type="text"
                [(ngModel)]="searchPlotId"
                class="flex-1"
                (input)="convertToUppercase($event)"
            />
            <p-button
                label="Search And Add"
                size="small"
                [loading]="checkingPlot"
                (click)="checkPlotDetailsAndAdd()"
            ></p-button>
        </div>
    </div>
    <div class="pt-4 mt-2" *ngIf="plotMappings.length">
        <p>Plot Mapping (Building is on the following plot/s)</p>
        <div *ngFor="let plot of plotMappings" class="font-bold">
            <div class="flex gap-2 align-items-center">
                <p>- {{ plot.plotId }}</p>
                <p>
                    <i
                        class="pi pi-trash cursor-pointer hover:underline text-red-600"
                        (click)="removePlotMapping(plot)"
                    ></i>
                </p>
            </div>
        </div>
    </div>
</div>

<form
    [formGroup]="createBuildingForm"
    class="p-fluid p-2"
    style="min-width: 40vw"
>
    <div class="grid">
        <div *ngIf="plotMappings.length" class="grid">
            <p class="col-12 font-semibold">Building Details</p>
            <hr class="col-12 m-0 p-0" />

            <div class="field col-12 md:col-6">
                <label for="zhichar">Zhichar Building ID</label>

                <input
                    pInputText
                    id="zhichar"
                    (keyup)="getZhicharBuildingInformation($event)"
                    formControlName="zhicharBuildingId"
                    type="text"
                />
                <label for="zhichar" class="text-sm mt-2"
                    >*press enter to search building details in zhichar</label
                >
            </div>

            <div class="field col-12 md:col-6">
                <label for="qrId">Zhichar Qr ID</label>
                <input
                    pInputText
                    id="qrId"
                    type="text"
                    formControlName="zhicharQrUuid"
                />
            </div>

            <p class="col-12 font-semibold">Physical Features</p>
            <hr class="col-12 m-0 p-0" />

            <div class="field col-12 md:col-4">
                <label for="buildingType">Building Type</label>
                <p-dropdown
                    [options]="buildingTypes"
                    formControlName="buildingType"
                    appendTo="body"
                ></p-dropdown>

                <div
                    *ngIf="
                        createBuildingForm.get('buildingType')?.invalid &&
                        createBuildingForm.get('buildingType')?.touched
                    "
                >
                    <small>Building Type is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="jamthogs">Jamthogs*</label>
                <p-dropdown
                    [options]="numberedDropDownOptions"
                    formControlName="jamthogCount"
                    appendTo="body"
                ></p-dropdown>

                <div
                    *ngIf="
                        createBuildingForm.get('jamthogCount')?.invalid &&
                        createBuildingForm.get('jamthogCount')?.touched
                    "
                >
                    <small>Jamthog Count is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="attic">Attic*</label>

                <p-dropdown
                    [options]="numberedDropDownOptions"
                    formControlName="atticCount"
                    appendTo="body"
                ></p-dropdown>
                <div
                    *ngIf="
                        createBuildingForm.get('atticCount')?.invalid &&
                        createBuildingForm.get('atticCount')?.touched
                    "
                >
                    <small>Attic Count is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="regularFloors">Regular Floors*</label>
                <p-dropdown
                    [options]="numberedDropDownOptions"
                    appendTo="body"
                    formControlName="regularFloorCount"
                ></p-dropdown>
                <div
                    *ngIf="
                        createBuildingForm.get('regularFloorCount')?.invalid &&
                        createBuildingForm.get('regularFloorCount')?.touched
                    "
                >
                    <small>Regular Floor Count is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="stilts">Stilts*</label>
                <p-dropdown
                    [options]="numberedDropDownOptions"
                    formControlName="stiltCount"
                    appendTo="body"
                ></p-dropdown>
                <div
                    *ngIf="
                        createBuildingForm.get('stiltCount')?.invalid &&
                        createBuildingForm.get('stiltCount')?.touched
                    "
                >
                    <small>Stilt Floor Count is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="basement">Basement*</label>
                <p-dropdown
                    [options]="numberedDropDownOptions"
                    formControlName="basementCount"
                    appendTo="body"
                ></p-dropdown>
                <div
                    *ngIf="
                        createBuildingForm.get('basementCount')?.invalid &&
                        createBuildingForm.get('basementCount')?.touched
                    "
                >
                    <small>Basement Floor Count is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-6">
                <label for="buildingArea">Building Area</label>

                <p-inputGroup>
                    <input
                        pInputText
                        id="buildingArea"
                        formControlName="areaSqM"
                    />
                    <p-inputGroupAddon> Sq. M </p-inputGroupAddon>
                </p-inputGroup>
            </div>

            <p class="col-12 font-semibold">Address and Location</p>
            <hr class="col-12 m-0 p-0" />

            <div class="field col-12 md:col-4">
                <label for="latitude">Latitude*</label>
                <input
                    pInputText
                    id="latitude"
                    type="text"
                    formControlName="latitude"
                />
                <div
                    *ngIf="
                        createBuildingForm.get('latitude')?.invalid &&
                        createBuildingForm.get('latitude')?.touched
                    "
                >
                    <small>Latitude is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="longitude">Longitude*</label>
                <input
                    pInputText
                    id="longitude"
                    type="text"
                    formControlName="longitude"
                />
                <div
                    *ngIf="
                        createBuildingForm.get('longitude')?.invalid &&
                        createBuildingForm.get('longitude')?.touched
                    "
                >
                    <small>Longitude is required.</small>
                </div>
            </div>
            <hr class="col-12 m-0 p-0" />

            <div class="field col-12 md:col-4">
                <label for="name">Building Name*</label>
                <input
                    pInputText
                    id="name"
                    type="text"
                    formControlName="name"
                />
                <div
                    *ngIf="
                        createBuildingForm.get('name')?.invalid &&
                        createBuildingForm.get('name')?.touched
                    "
                >
                    <small>Building Name is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="buildingNumber">Building Number*</label>
                <input
                    pInputText
                    id="buildingNumber"
                    type="text"
                    formControlName="buildingNumber"
                />
                <div
                    *ngIf="
                        createBuildingForm.get('buildingNumber')?.invalid &&
                        createBuildingForm.get('buildingNumber')?.touched
                    "
                >
                    <small>Building Number is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="address">Address</label>
                <input
                    pInputText
                    id="address"
                    type="text"
                    formControlName="address"
                />
            </div>

            <div class="field col-12 md:col-4">
                <label for="landmark">Land Mark</label>
                <textarea
                    pInputTextarea
                    id="landmark"
                    formControlName="landmark"
                    rows="1"
                ></textarea>
            </div>
            <hr class="col-12 m-0 p-0" />

            <div class="field col-12 md:col-4">
                <label for="dzongkhag">Dzongkhag* <br /> </label>
                <p-dropdown
                    [options]="dzongkhags"
                    optionLabel="name"
                    optionValue="id"
                    (onChange)="dzongkhagSelected($event)"
                    formControlName="dzongkhagId"
                    appendTo="body"
                ></p-dropdown>
                <div
                    *ngIf="
                        createBuildingForm.get('dzongkhagId')?.invalid &&
                        createBuildingForm.get('dzongkhagId')?.touched
                    "
                >
                    <small>Dzongkhag is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="thromde">Thromde/Gewog* </label>
                <p-dropdown
                    [options]="admninistrativeZones"
                    optionLabel="name"
                    optionValue="id"
                    (onChange)="administrativeZoneSelected($event)"
                    formControlName="administrativeZoneId"
                    appendTo="body"
                ></p-dropdown>
                <div
                    *ngIf="
                        createBuildingForm.get('administrativeZoneId')
                            ?.invalid &&
                        createBuildingForm.get('administrativeZoneId')?.touched
                    "
                >
                    <small>Thromde/Gewog is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="locality">Locality/Chiwog* </label>
                <p-dropdown
                    [options]="subAdministrativeZones"
                    optionLabel="name"
                    optionValue="id"
                    formControlName="subadministrativeZoneId"
                    appendTo="body"
                ></p-dropdown>
                <div
                    *ngIf="
                        createBuildingForm.get('subadministrativeZoneId')
                            ?.invalid &&
                        createBuildingForm.get('subadministrativeZoneId')
                            ?.touched
                    "
                >
                    <small>Locality/Chiwog is required.</small>
                </div>
            </div>

            <div class="field col-12 md:col-4">
                <label for="dzongkhag">Year of Construction</label>
                <p-inputNumber
                    formControlName="yearOfConstruction"
                    mode="decimal"
                    inputId="withoutgrouping"
                    [useGrouping]="false"
                />
            </div>
            <div class="field col-12 md:col-4">
                <label for="dzongkhag">Year of Capitalization</label>
                <p-inputNumber
                    formControlName="yearOfCapitalization"
                    mode="decimal"
                    inputId="withoutgrouping"
                    [useGrouping]="false"
                />
            </div>
            <div class="field col-12 md:col-4">
                <label for="dzongkhag">Building Value</label>
                <p-inputGroup>
                    <p-inputGroupAddon>Nu</p-inputGroupAddon>
                    <p-inputNumber
                        formControlName="buildingValue"
                        inputId="minmaxfraction"
                        mode="decimal"
                        [minFractionDigits]="0"
                        [maxFractionDigits]="5"
                    />
                </p-inputGroup>
            </div>

            <div class="col-12 md:12 flex align-items-center gap-3">
                <p-checkbox
                    formControlName="isActive"
                    binary="true"
                    inputId="ny"
                ></p-checkbox>
                <label for="ny"
                    >Is the building Currently Active in the system?*</label
                >
            </div>

            <div class="flex justify-content-end gap-2">
                <p-button
                    (click)="createBuilding()"
                    type="submit"
                    [disabled]="isSubmitting || createBuildingForm.invalid"
                    label="Create Building"
                ></p-button>
                <p-button
                    severity="secondary"
                    label="Cancel"
                    (click)="close()"
                ></p-button>
            </div>
        </div>
    </div>
</form>
