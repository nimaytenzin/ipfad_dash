<div class="pg-modal-container">
    <p-dialog
        header=""
        [modal]="true"
        [closable]="false"
        [(visible)]="loadingModal"
        [style]="{ width: '25rem' }"
    >
        <div>{{ loadingModalMessage }}</div>
    </p-dialog>
    <div class="text-lg my-2">
        <p class="font-bold underline text-center">
            Subject: {{ paymentAdvice.title }}
        </p>

        <p class="text-center font-bold mt-1 mb-3">
            Total Amount: {{ paymentAdvice.totalAmount }}
        </p>
        <div class="mb-4 text-center text-sm">
            Amount of
            <span class="font-bold text-red-800">Nu {{ deductAmout }} </span>
            will be deducted from your account
        </div>
    </div>
    <p-divider type="dotted" />

    <div class="p-4 mt-2">
        <p-stepper [linear]="true">
            <p-stepperPanel header="Select Bank">
                <ng-template
                    pTemplate="content"
                    let-nextCallback="nextCallback"
                    let-index="index"
                >
                    <p-divider type="dotted" />

                    <div class="flex flex-column justify-content-between">
                        <div>
                            <div
                                *ngIf="!authorizationResponse && !errored"
                                class="flex flex-column justify-content-between align-items-center"
                            >
                                <p class="my-4">Loading bank list...</p>
                                <p-button
                                    label="Refresh Bank List"
                                    (click)="sendAuthorizationRequest()"
                                    size="small"
                                >
                                </p-button>
                            </div>
                            <div
                                *ngIf="errored"
                                class="flex flex-column justify-content-between align-items-center"
                            >
                                <p
                                    class="text-xl text-red-600 text-center my-4"
                                >
                                    {{ errorMessage }}
                                </p>
                                <p-button
                                    label="Try Again"
                                    size="small"
                                    severity="secondary"
                                    (click)="sendAuthorizationRequest()"
                                >
                                </p-button>
                            </div>

                            <div *ngIf="authorizationResponse">
                                <p class="font-bold text-lg mt-2 mb-3">
                                    Select Bank
                                </p>
                                <p-listbox
                                    [options]="
                                        authorizationResponse.bfs_bankList
                                    "
                                    [(ngModel)]="selectedBank"
                                    optionLabel="bankName"
                                    [listStyle]="{
                                        'max-height': 'max-content'
                                    }"
                                >
                                    >
                                    <ng-template let-bank pTemplate="item">
                                        <div
                                            class="flex align-items-center gap-2"
                                        >
                                            <p-radioButton
                                                [inputId]="bank.bankCode"
                                                [value]="bank"
                                                [(ngModel)]="selectedBank"
                                            />
                                            <p>{{ bank.bankName }}</p>
                                        </div>
                                    </ng-template>
                                </p-listbox>
                            </div>

                            <div
                                *ngIf="selectedBank"
                                class="mt-3 bg-blue-50 p-2 border-rounded"
                            >
                                <p class="mb-2">You have Selected</p>
                                <div
                                    class="flex gap-2 font-bold align-items-center"
                                >
                                    <img
                                        style="height: 30px"
                                        [src]="
                                            getBankLogo(selectedBank.bankName)
                                        "
                                    />
                                    <p>
                                        {{ selectedBank.bankName }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex pt-4 justify-content-end">
                        <p-button
                            label="Next"
                            icon="pi pi-arrow-right"
                            iconPos="right"
                            [disabled]="!selectedBank"
                            (onClick)="nextCallback.emit()"
                        />
                    </div>
                </ng-template>
            </p-stepperPanel>
            <p-stepperPanel header="Enter Account No">
                <ng-template
                    pTemplate="content"
                    let-prevCallback="prevCallback"
                    let-nextCallback="nextCallback"
                    let-index="index"
                >
                    <p-divider type="dotted" />

                    <div
                        class="flex flex-column p-fluid align-items-center justify-content-center"
                    >
                        <div
                            *ngIf="selectedBank"
                            class="mt-4 w-12 bg-blue-50 p-2 border-rounded"
                        >
                            <p class="mb-2">Selected Bank</p>
                            <div
                                class="flex gap-2 font-bold align-items-center"
                            >
                                <img
                                    style="height: 30px"
                                    [src]="getBankLogo(selectedBank.bankName)"
                                />
                                <p>
                                    {{ selectedBank.bankName }}
                                </p>
                            </div>
                            <p class="text-sm">
                                Transaction #
                                {{ authorizationResponse.bfs_bfsTxnId }}
                            </p>
                        </div>

                        <hr />
                        <div class="flex flex-column gap-2 w-12 mb-4">
                            <label for="username" class="font-semibold"
                                >Account Number</label
                            >
                            <input
                                pInputText
                                aria-describedby="username-help"
                                [(ngModel)]="accountNumber"
                            />
                        </div>
                    </div>
                    <div class="flex pt-4 justify-content-between">
                        <p-button
                            label="Back"
                            icon="pi pi-arrow-left"
                            (onClick)="prevCallback.emit()"
                        />
                        <p-button
                            label="Next"
                            icon="pi pi-arrow-right"
                            iconPos="right"
                            (onClick)="sendBankAccountDetails(nextCallback)"
                        />
                    </div>
                </ng-template>
            </p-stepperPanel>
            <p-stepperPanel header="Enter OTP">
                <ng-template
                    pTemplate="content"
                    let-prevCallback="prevCallback"
                    let-index="index"
                >
                    <p-divider type="dotted" />

                    <div
                        class="flex flex-column mb-3 p-fluid align-items-center justify-content-center"
                    >
                        <div
                            *ngIf="selectedBank"
                            class="mt-4 mb-5 w-12 bg-blue-50 p-2 border-rounded"
                        >
                            <p class="mb-2">Selected Bank</p>
                            <div
                                class="flex gap-2 font-bold align-items-center"
                            >
                                <img
                                    style="height: 30px"
                                    [src]="getBankLogo(selectedBank.bankName)"
                                />
                                <p>
                                    {{ selectedBank.bankName }}
                                </p>
                            </div>
                            <p class="font-semibold">
                                Account Number: {{ accountNumber }}
                            </p>
                            <p class="text-sm">
                                Transaction #
                                {{ authorizationResponse.bfs_bfsTxnId }}
                            </p>
                        </div>
                        <div class="flex flex-column gap-2 w-12 mb-4">
                            <label for="username" class="font-semibold"
                                >Enter OTP</label
                            >
                            <input pInputText [(ngModel)]="otp" />
                        </div>

                        <p-button
                            (click)="sendOtp()"
                            label="Confirm Payment"
                        ></p-button>
                    </div>
                </ng-template>
            </p-stepperPanel>
        </p-stepper>
    </div>
</div>
